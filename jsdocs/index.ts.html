

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> index.ts</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Global</h3><ul><li><a href="global.html#addIndicators">addIndicators</a></li><li><a href="global.html#addNewGameLine">addNewGameLine</a></li><li><a href="global.html#addTargetListener">addTargetListener</a></li><li><a href="global.html#applyParameters">applyParameters</a></li><li><a href="global.html#changePieceDisplay">changePieceDisplay</a></li><li><a href="global.html#createNewRound">createNewRound</a></li><li><a href="global.html#displayLoosePopup">displayLoosePopup</a></li><li><a href="global.html#displayWinPopup">displayWinPopup</a></li><li><a href="global.html#duplicate">duplicate</a></li><li><a href="global.html#generateCombination">generateCombination</a></li><li><a href="global.html#getAvailableColors">getAvailableColors</a></li><li><a href="global.html#getColorApparition">getColorApparition</a></li><li><a href="global.html#getCombinationPlacement">getCombinationPlacement</a></li><li><a href="global.html#getCurrentCombination">getCurrentCombination</a></li><li><a href="global.html#getGameDomElements">getGameDomElements</a></li><li><a href="global.html#hideUnwantedColor">hideUnwantedColor</a></li><li><a href="global.html#nbColors">nbColors</a></li><li><a href="global.html#nbPossibilities">nbPossibilities</a></li><li><a href="global.html#nbTurns">nbTurns</a></li><li><a href="global.html#removeColorFromTarget">removeColorFromTarget</a></li><li><a href="global.html#removeTargetListener">removeTargetListener</a></li><li><a href="global.html#setDragListenerOnPieces">setDragListenerOnPieces</a></li><li><a href="global.html#setPieceDragData">setPieceDragData</a></li><li><a href="global.html#setTargetBackgroundColor">setTargetBackgroundColor</a></li><li><a href="global.html#setTargetDropEffect">setTargetDropEffect</a></li><li><a href="global.html#startNewGame">startNewGame</a></li><li><a href="global.html#verifyCurrentCombination">verifyCurrentCombination</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>index.ts</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {
  getCurrentCombination,
  getCombinationPlacement,
  generateCombination,
  getAvailableColors,
} from './combination';

import {
  addTargetListener,
  removeTargetListener,
  setDragListenerOnPieces,
} from './listeners';

import {
  addNewGameLine,
  addIndicators,
  Indicators,
  hideUnwantedColor,
  getGameDomElements,
} from './dom-manipulation';

// get the game container
const gameContainer = document.getElementById(
  'game-container',
) as HTMLDivElement;

// Get all the pieces of the game
const bluePiece = document.getElementById('blue-piece') as HTMLDivElement;
const redPiece = document.getElementById('red-piece') as HTMLDivElement;
const greenPiece = document.getElementById('green-piece') as HTMLDivElement;
const yellowPiece = document.getElementById('yellow-piece') as HTMLDivElement;
const orangePiece = document.getElementById('orange-piece') as HTMLDivElement;
const blackPiece = document.getElementById('black-piece') as HTMLDivElement;
const whitePiece = document.getElementById('white-piece') as HTMLDivElement;
const marronPiece = document.getElementById('maroon-piece') as HTMLDivElement;
const pieces = [
  bluePiece,
  redPiece,
  greenPiece,
  yellowPiece,
  orangePiece,
  blackPiece,
  whitePiece,
  marronPiece,
];

setDragListenerOnPieces(pieces);

// Get all Popup
const parametersPopup = document.getElementById(
  'parametersPopup',
) as HTMLDivElement;
const winPopup = document.getElementById('win') as HTMLDivElement;
const loosePopup = document.getElementById('loose') as HTMLDivElement;

// All the color available in the game based on the pieces id available
const COLORS = pieces.map((piece) => piece.id.split('-')[0]);

// The button of the game
const applyParametersButton = document.getElementById(
  'applyParameters',
) as HTMLButtonElement;
const cancelParametersButton = document.getElementById(
  'cancelParameters',
) as HTMLButtonElement;
const verifyButton = document.getElementById('verify') as HTMLButtonElement;
const restartButton = document.getElementById('restart') as HTMLButtonElement;
const winRestartButton = document.getElementById(
  'win-restart',
) as HTMLButtonElement;
const looseRestartButton = document.getElementById(
  'loose-restart',
) as HTMLButtonElement;
const parametersButton = document.getElementById(
  'parameters',
) as HTMLButtonElement;

// Parameters value from the DOM Popup
const duplicateCheckBox = document.getElementById(
  'duplicateCheck',
) as HTMLInputElement;
const nbColorsValue = document.getElementById(
  'nbColorsValue',
) as HTMLInputElement;
const nbTurnsValue = document.getElementById(
  'nbTurnsValue',
) as HTMLInputElement;
const nbPossibilitiesValue = document.getElementById(
  'nbPossibilitiesValue',
) as HTMLInputElement;

// Current game round
// min : 1 | max : nbTurns
let currentRound: number;

// Game DOM variables
let currentTargets: NodeListOf&lt;HTMLDivElement>;
let currentRedIndicatorsContainer: HTMLDivElement;
let currentWhiteIndicatorsContainer: HTMLDivElement;

let gameCombination: string[];

// Game params

/**
 * A boolean that indicates whether the combination can have
 * duplicate colors or not
 **/
let duplicate = duplicateCheckBox.checked;

/**
 * The number of turns in the game
 */
let nbTurns = nbTurnsValue.valueAsNumber;

/**
 * The number of colors available for the player
 */
let nbColors = nbColorsValue.valueAsNumber;

/**
 * The number of colors in a line
 */
let nbPossibilities = nbPossibilitiesValue.valueAsNumber;

/**
 * @description Reset all the HTML of the game container and start a new game
 * by generating a new combination and reset game DOM variables
 */
function startNewGame() {
  currentRound = 1;

  const colorsAvailable = getAvailableColors(COLORS, nbColors);

  hideUnwantedColor(COLORS, colorsAvailable);

  gameCombination = generateCombination(
    colorsAvailable,
    nbPossibilities,
    duplicate,
  );

  gameContainer.innerHTML = '';
  addNewGameLine(currentRound, gameContainer, nbPossibilities);

  const { targets, redIndicatorsContainer, whiteIndicatorsContainer } =
    getGameDomElements(currentRound);

  currentTargets = targets;
  currentRedIndicatorsContainer = redIndicatorsContainer;
  currentWhiteIndicatorsContainer = whiteIndicatorsContainer;
  addTargetListener(currentTargets, COLORS);
}

/**
 * @description Remove all the events of the previous line, create a new line with the current index,
 * update the game DOM variables and add eventListeners to them
 */
function createNewRound() {
  removeTargetListener(currentTargets);

  currentRound++;

  addNewGameLine(currentRound, gameContainer, nbPossibilities);
  const { targets, redIndicatorsContainer, whiteIndicatorsContainer } =
    getGameDomElements(currentRound);

  currentTargets = targets;
  currentRedIndicatorsContainer = redIndicatorsContainer;
  currentWhiteIndicatorsContainer = whiteIndicatorsContainer;
  addTargetListener(currentTargets, COLORS);
}

/**
 * @description Add the nbRound value to the win popup and display it
 */
function displayWinPopup() {
  (
    document.getElementById('nb-round') as HTMLParagraphElement
  ).innerHTML = `Tu as trouv√© la combinaison en ${currentRound} tours`;
  winPopup.style.display = 'flex';
}

/**
 * @description Add the game combination to the loose popup and display it
 */
function displayLoosePopup() {
  const solutionCombinaison = document.getElementById(
    'solution-combination',
  ) as HTMLDivElement;

  // Reset previous solution
  solutionCombinaison.innerHTML = '';

  for (let i = 0; i &lt; gameCombination.length; i++) {
    const div = document.createElement('div');
    div.classList.add('piece', gameCombination[i]);
    solutionCombinaison.appendChild(div);
  }
  loosePopup.style.display = 'flex';
}

/**
 * @description Verify the current combination. It can either:
 *  - display an error if the currentCombination is not complete
 *  - add indicators to the current line and add a new line
 *  - display win popup if the player find the gameCombination
 *  - display loose popup if the player failed to find the gameCombination
 */
function verifyCurrentCombination() {
  let currentCombination: string[];

  try {
    currentCombination = getCurrentCombination(currentTargets, COLORS);
  } catch (err) {
    alert('Mettez des pions dans chaque emplacement de la ligne');
    return;
  }

  const { goodPlacement, wrongPlacement } = getCombinationPlacement(
    currentCombination,
    gameCombination,
  );

  addIndicators(Indicators.red, currentRedIndicatorsContainer, goodPlacement);

  addIndicators(
    Indicators.white,
    currentWhiteIndicatorsContainer,
    wrongPlacement,
  );

  if (goodPlacement === nbPossibilities) {
    displayWinPopup();
    return;
  }

  if (currentRound === nbTurns) {
    displayLoosePopup();
    return;
  }

  createNewRound();
}

/**
 * @description Set the params value and check if a new game can start with these params. If not,
 * it display an error
 */
function applyParameters() {
  duplicate = duplicateCheckBox.checked;
  nbColors = nbColorsValue.valueAsNumber;
  nbTurns = nbTurnsValue.valueAsNumber;
  nbPossibilities = nbPossibilitiesValue.valueAsNumber;
  if (duplicate === false &amp;&amp; nbColors &lt; nbPossibilities) {
    alert(
      `Attention, autorisez les doublons ou mettez un nombre de couleurs sup√©rieur ou √©gal au nombre de possibilit√©s par ligne`,
    );
    return;
  }
  parametersPopup.style.display = 'none';
  startNewGame();
}

verifyButton.onclick = verifyCurrentCombination;

restartButton.onclick = startNewGame;

// add apply parameters event
applyParametersButton.onclick = applyParameters;

// add cancel parameters event
cancelParametersButton.onclick = () => {
  parametersPopup.style.display = 'none';
};

parametersButton.onclick = () => {
  parametersPopup.style.display = 'flex';
};

winRestartButton.onclick = (e) => {
  e.preventDefault();
  winPopup.style.display = 'none';
  startNewGame();
};

looseRestartButton.onclick = (e) => {
  e.preventDefault();
  loosePopup.style.display = 'none';
  startNewGame();
};

startNewGame();
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
